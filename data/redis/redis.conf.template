# Redis配置文件

################################## 网络配置 ##################################

# 监听端口
port ${REDIS_PORT:-6379}

# 绑定地址，默认只允许本地连接
bind 127.0.0.1

# TCP监听队列长度
tcp-backlog 511

# 客户端空闲超时时间（秒）
timeout 0

# TCP keepalive
tcp-keepalive 300

################################## 通用配置 ##################################

# 是否以守护进程方式运行
daemonize no

# 进程文件
pidfile ${REDIS_DATA_DIR}/redis.pid

# 日志级别：debug, verbose, notice, warning
loglevel notice

# 日志文件
logfile ${REDIS_DATA_DIR}/redis.log

# 数据库数量
databases 16

################################## 快照配置 ##################################

# 数据持久化策略
save 900 1
save 300 10
save 60 10000

# 当RDB持久化出现错误后，是否依然进行工作
stop-writes-on-bgsave-error yes

# 使用压缩rdb文件
rdbcompression yes

# 存储快照后，让redis使用CRC64算法来进行数据校验
rdbchecksum yes

# 快照文件名
dbfilename dump.rdb

# 数据目录
dir ${REDIS_DATA_DIR}

################################## 复制配置 ##################################

# 主从复制配置
# slaveof <masterip> <masterport>
# masterauth <master-password>

# 从服务器只读
slave-read-only yes

# 复制超时时间
repl-timeout 60

# 复制缓冲区大小
repl-backlog-size 1mb

# 复制缓冲区超时时间
repl-backlog-ttl 3600

################################## 安全配置 ##################################

# 访问密码
requirepass ${REDIS_PASSWORD:-}

# 重命名危险命令
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command KEYS ""
# rename-command CONFIG ""

################################## 内存管理 ##################################

# 最大内存限制
maxmemory 

# 内存淘汰策略
# noeviction: 不删除策略, 达到最大内存限制时, 如果需要更多内存, 直接返回错误信息
# allkeys-lru: 所有key通用; 优先删除最近最少使用(less recently used ,LRU) 的 key
# volatile-lru: 只限于设置了 expire 的部分; 优先删除最近最少使用(less recently used ,LRU) 的 key
# allkeys-random: 所有key通用; 随机删除一部分 key
# volatile-random: 只限于设置了 expire 的部分; 随机删除一部分 key
# volatile-ttl: 只限于设置了 expire 的部分; 优先删除剩余时间(time to live,TTL) 短的key
maxmemory-policy noeviction

# LRU和TTL算法的样本数量
maxmemory-samples 5

################################## AOF配置 ##################################

# 开启AOF持久化
appendonly no

# AOF文件名
appendfilename appendonly.aof

# AOF同步策略
# always: 每次写入都同步
# everysec: 每秒同步一次
# no: 不主动同步，由操作系统决定
appendfsync everysec

# 重写时是否同步
no-appendfsync-on-rewrite no

# AOF重写触发条件
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# AOF加载时是否忽略最后一条可能存在问题的指令
aof-load-truncated yes

################################## LUA脚本 ##################################

# Lua脚本最长运行时间
lua-time-limit 5000

################################## 慢日志 ##################################

# 慢查询日志记录时间阈值（微秒）
slowlog-log-slower-than 10000

# 慢查询日志最大长度
slowlog-max-len 128

################################## 延迟监控 ##################################

# 延迟监控阈值（毫秒）
latency-monitor-threshold 0

################################## 事件通知 ##################################

# 键空间通知配置
notify-keyspace-events ""

################################## 高级配置 ##################################

# 哈希表配置
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# 列表配置
list-max-ziplist-size -2
list-compress-depth 0

# 集合配置
set-max-intset-entries 512

# 有序集合配置
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog配置
hll-sparse-max-bytes 3000

# 流配置
stream-node-max-bytes 4096
stream-node-max-entries 100

# 活跃重新哈希
activerehashing yes

# 客户端输出缓冲区限制
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# 客户端查询缓冲区限制
client-query-buffer-limit 1gb

# 协议缓冲区限制
proto-max-bulk-len 512mb

# 频率限制
hz 10

# 动态频率调整
dynamic-hz yes

# AOF重写增量同步
aof-rewrite-incremental-fsync yes

# RDB保存增量同步
rdb-save-incremental-fsync yes

################################## 模块配置 ##################################

# 加载模块
# loadmodule /path/to/my_module.so

################################## 包含其他配置文件 ##################################

# 包含其他配置文件
# include /path/to/local.conf
# include /path/to/other.conf

################################## 应用程序特定配置 ##################################

# 队列前缀（应用程序使用）
# 注意：这不是Redis标准配置，仅用于应用程序识别
# tts_queue